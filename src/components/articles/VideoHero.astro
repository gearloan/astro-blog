---
// src/components/articles/media/VideoHero.astro
import { parseVideo } from '@/lib/video/parse';

const { post } = Astro.props as { post: any };
const media = parseVideo(post?.videoUrl);
const poster = post?.featuredImage?.node?.sourceUrl ?? post?.featuredImageUrl;
const alt = post?.featuredImage?.node?.altText || post?.title || 'Video';
---

{media?.kind === 'youtube' && (
  <div class="aspect-video w-full overflow-hidden shadow">
    <iframe
      class="h-full w-full"
      src={`https://www.youtube.com/embed/${media.id}`}
      title={alt}
      loading="lazy"
      allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share"
      allowfullscreen
    />
  </div>
)}

{media?.kind === 'vimeo' && (
  <div class="aspect-video w-full overflow-hidden rounded-2xl shadow">
    <iframe
      class="h-full w-full"
      src={`https://player.vimeo.com/video/${media.id}`}
      title={alt}
      loading="lazy"
      allow="autoplay; fullscreen; picture-in-picture"
      allowfullscreen
    />
  </div>
)}

{media?.kind === 'mp4' && (
  <div class="w-full overflow-hidden rounded-2xl shadow">
    <video class="h-auto w-full" controls preload="metadata" poster={poster}>
      <source src={media.url} type="video/mp4" />
      Your browser does not support HTML5 video.
    </video>
  </div>
)}
