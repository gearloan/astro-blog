---
import { fetchPosts } from '../../lib/fetchPosts.js';

const posts = await fetchPosts({ tag: 'editorial' }) ?? [];
const [leadStory, ...rest] = posts;
const leftStories  = rest.slice(0, 2);
const rightStories = rest.slice(2, 4);

const { proseStyle = 'prose-editorial' } = Astro.props;
const headingSize = '3rem';

const toExcerpt = (html = '', words = 20) =>
  html.replace(/<[^>]*>/g, '').trim().split(/\s+/).slice(0, words).join(' ') + 'â€¦';
---

<section style={`--fs-heading: ${headingSize};`}
  class={`max-w-7xl mx-auto px-4 pt-8 pb-4 border-b border-gray-300 mb-8 grid grid-cols-1 lg:grid-cols-12 gap-6 ${proseStyle}`}>

  <aside class="lg:col-span-2 space-y-8 order-2 lg:order-1">
    <h4 class="ui-label tracking-widest">LATEST STORIES</h4>
    {leftStories.filter(Boolean).map(story => (
      <article class="!mt-2">
        <h3 class="text-xl mb-1 leading-[1.2] hover:underline">
          <a href={`/blog-post/${story.slug}`}>{story.title}</a>
        </h3>
        <p class="text-gray-600 dark:text-gray-400 mb-1 leading-[1.3] text-lg">
          {toExcerpt(story.excerpt, 20)}
        </p>
        <a href={`/blog-post/${story.slug}`} class="text-sm text-blue-600 hover:underline">Read more</a>
      </article>
    ))}
  </aside>

  {leadStory && (
  <article class="lg:col-span-8 order-1 lg:order-2">
    <div class="relative">
      {/* {leadStory.isBreaking && (
        <div class="absolute top-0 left-1/2 -translate-x-1/2 z-10 bg-cyan-300 text-blue-800 px-8 py-4 ui-label font-bold uppercase rounded-b-md shadow-md">
          Breaking News
        </div>
      )} */}
      <img
        src={leadStory.featuredImage?.node?.sourceUrl}
        alt={leadStory.title ?? 'Article image'}
        width="1600" height="900" sizes="(min-width:1024px) 66vw, 100vw"
        class="w-full h-auto mb-1 md:mb-4 object-cover rounded" />
    </div>
    <h1 class="leading-tight mb-2 hover:underline" style="font-size: var(--fs-heading)">
      <a href={`/blog-post/${leadStory.slug}`}>{leadStory.title}</a>
    </h1>
    <div class="text-base text-gray-700" set:html={leadStory.blurb}></div>
  </article>
  )}

  <aside class="lg:col-span-2 space-y-8 order-3 lg:order-3">
    <h4 class="ui-label font-normal tracking-widest">ADVOCACY</h4>
    {rightStories.filter(Boolean).map(story => (
      <article class="!mt-2">
        <h3 class="text-xl mb-1 leading-[1.2] hover:underline">
          <a href={`/blog-post/${story.slug}`}>{story.title}</a>
        </h3>
        <p class="text-gray-600 dark:text-gray-400 mb-1 leading-[1.3] text-lg">
          {toExcerpt(story.excerpt, 15)} {/* comment matches code now */}
        </p>
        <a href={`/blog-post/${story.slug}`} class="text-sm text-blue-600 hover:underline">Read more</a>
      </article>
    ))}
  </aside>

</section>
