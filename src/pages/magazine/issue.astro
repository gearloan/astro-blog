---
// src/pages/magazine/[slug].astro
import Layout from '../../layouts/Layout.astro';
import { fetchPosts } from '../../lib/fetchPosts.js';

const posts = await fetchPosts();

// Use ACF fields to categorize the stories
const heroStory = posts.find(p => p.acf?.presentation_slot === 'hero');
const featuredStories = posts.filter(p => p.acf?.presentation_slot === 'featured');
const teaserStories = posts.filter(p => p.acf?.presentation_slot === 'teaser');

const { proseStyle = 'prose-magazine' } = Astro.props;
---
<Layout section="magazine">
  <div class={`grid grid-cols-1 md:grid-cols-[250px_1fr] min-h-screen ${proseStyle}`}>
    <aside class="...">...</aside>

    <section class="bg-black text-white p-6">
      <!-- Hero -->
      {heroStory && (
        <section class="grid grid-cols-1 md:grid-cols-[2fr_3fr] gap-8 items-center mb-12">
          <div>
            <h1 class="text-6xl font-black tracking-tight leading-tight mb-4">
              FLYING IN <br />
              <span class="text-4xl font-medium tracking-normal">{heroStory.title}</span>
            </h1>
            <ul class="mt-6 space-y-2 text-xl text-gray-300 leading-snug">
              {teaserStories.map(teaser => (
                <li>{teaser.title}</li>
              ))}
            </ul>
          </div>
          <div>
            <img
              src={heroStory.featuredImage?.node?.sourceUrl}
              alt={heroStory.title}
              class="w-full h-auto object-cover rounded shadow-lg"
            />
          </div>
        </section>
      )}

      <!-- Featured Stories -->
      <section class="bg-gray-800 p-6 rounded-md">
        <h2 class="text-pink-500 uppercase tracking-widest text-sm mb-4">Featured Stories</h2>
        <div class="grid grid-cols-1 lg:grid-cols-3 gap-4">
          {featuredStories.map(story => (
            <article>
              <img src={story.featuredImage?.node?.sourceUrl} alt={story.title} class="..." />
              <h3 class="...">{story.title}</h3>
              <p class="...">{story.excerpt.replace(/<[^>]*>/g, '').split(' ').slice(0, 30).join(' ') + '...'}</p>
              <a href={`/blog-post/${story.slug}`}>Read more</a>
            </article>
          ))}
        </div>
      </section>
    </section>
  </div>
</Layout>
